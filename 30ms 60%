from Epaisseur import *
from scipy.interpolate import make_interp_spline

#Evolution de l'épaisseur de la ZMT pour chaque tir
# X est une liste de liste qui contient la valeur l'épaisseur de la ZMT pour chaque image et chaque tir
# X[0] correspond à l'évolution de l'épaisseur de la ZMT pour le tir "image_shot2"
#Ici, on exploite 60% de la largeur de la ZMT

X =[[0.007932948453608249, 0.008091705263157894, 0.0083104, 0.008606181818181817, 0.008891707317073172, 0.009227473684210527, 0.00950208, 0.009849620253164557, 0.010073368421052631, 0.010241, 0.010362210526315791, 0.01066345945945946, 0.01090043373493976, 0.01103709090909091, 0.011237333333333334, 0.011548229885057472, 0.011686211764705882, 0.011870682352941177, 0.011801023255813954, 0.01145995061728395, 0.013105513513513516, 0.013178474226804121, 0.013693573033707865, 0.014322442105263157, 0.014750515463917526, 0.01513039175257732, 0.015494103092783505, 0.015849731958762887, 0.01610432989690722, 0.016424359550561797, 0.016709, 0.01703658426966292, 0.017221272727272727, 0.017395, 0.017617727272727274, 0.017747284210526317, 0.01794122105263158, 0.018056757894736843, 0.018271326315789472, 0.018444206185567014]
]
X.append([0.007743010309278352, 0.008094153846153848, 0.0086534, 0.008749641025641026, 0.009334144927536233, 0.009548000000000001, 0.009735561643835617, 0.009987945205479453, 0.010056307692307693, 0.010117837837837837, 0.01030854054054054, 0.010339000000000001, 0.01070618181818182, 0.011081170731707318, 0.01109978947368421, 0.011362974358974359, 0.011536, 0.011868626506024098, 0.011208615384615385, 0.012955848101265825, 0.01272181443298969, 0.013420948453608248, 0.013808907216494845, 0.014297896907216496, 0.014762639175257733, 0.015126350515463918, 0.015457731958762887, 0.015869938144329895, 0.0162659793814433, 0.01661352577319588, 0.016997443298969076, 0.01735307216494845, 0.017736989690721648, 0.01799158762886598, 0.018294680412371134, 0.018492701030927837, 0.018690721649484536, 0.018888742268041235, 0.01914738144329897, 0.01938177319587629]
)
X.append([0.00807439175257732, 0.008264329896907216, 0.008560774193548388, 0.008869, 0.00922567441860465, 0.009477176470588235, 0.009705721518987341, 0.009971500000000001, 0.010267384615384616, 0.010294027397260274, 0.010623200000000001, 0.010819200000000001, 0.011085951219512195, 0.011335333333333334, 0.011606, 0.011797333333333333, 0.012030666666666667, 0.012836923076923077, 0.012061885057471265, 0.01239865168539326, 0.014149783132530121, 0.014079670103092785, 0.014629278350515466, 0.01516676288659794, 0.015655752577319586, 0.016084123711340208, 0.016484206185567014, 0.01683579381443299, 0.01720758762886598, 0.01748239175257732, 0.017745072164948455, 0.018060288659793818, 0.018262350515463918, 0.018473, 0.018640416666666666, 0.018856833333333333, 0.019042947368421055, 0.01919562105263158, 0.01942256842105263, 0.019713154639175258]
)
X.append([0.008407148936170214, 0.008593846153846155, 0.008943565217391305, 0.009299111111111112, 0.009604, 0.009917149425287358, 0.0101675, 0.010197297297297297, 0.010338268656716417, 0.01078784, 0.011018378378378378, 0.011262829268292683, 0.011342871794871794, 0.011532543209876544, 0.012007816091954024, 0.012215080459770114, 0.012469333333333334, 0.013689052631578947, 0.012618273684210526, 0.012902279569892474, 0.014566146341463415, 0.014303644444444446, 0.015259711340206185, 0.015720412371134022, 0.016225567010309278, 0.016662020618556702, 0.017082309278350513, 0.017429855670103092, 0.017809731958762884, 0.018096659793814435, 0.018403793814432988, 0.018723051546391752, 0.01899381443298969, 0.019248412371134022, 0.01950301030927835, 0.019765690721649486, 0.020076865979381443, 0.02034358762886598, 0.020602226804123713, 0.020824494845360825]
)
X.append([0.008696742268041237, 0.008991752577319588, 0.00943848888888889, 0.009804454545454547, 0.010137302325581396, 0.010526090909090909, 0.01077274074074074, 0.0110593, 0.011088, 0.011382168674698795, 0.011573560975609756, 0.011871308641975309, 0.012218926829268293, 0.012411759036144578, 0.012601365853658538, 0.012996977777777778, 0.01303639024390244, 0.013643512195121952, 0.012713178947368422, 0.014266297872340426, 0.014545505882352943, 0.014904615384615386, 0.015481846153846155, 0.016128, 0.01670092307692308, 0.01717476923076923, 0.017726153846153846, 0.01819569230769231, 0.018548923076923077, 0.018876307692307692, 0.019272615384615388, 0.01969476923076923, 0.019953230769230768, 0.020229842696629214, 0.020595076923076924, 0.02085353846153846, 0.020987076923076924, 0.02113353846153846, 0.02148246153846154, 0.02177969230769231]
)
X.append([0.008333030927835052, 0.008577634408602151, 0.008846268041237115, 0.009180818181818182, 0.009462068965517241, 0.009836045977011494, 0.010051654320987655, 0.0104223, 0.0106526, 0.010843759036144578, 0.011243707317073172, 0.011467180722891568, 0.01167498795180723, 0.011925301204819277, 0.01221195294117647, 0.012376000000000002, 0.012694769230769232, 0.013948666666666668, 0.012664615384615384, 0.013455518072289155, 0.015039414634146344, 0.014710103092783507, 0.015259711340206185, 0.015748701030927837, 0.016270020618556702, 0.016657979381443297, 0.017017649484536084, 0.017373278350515466, 0.01776123711340206, 0.01804816494845361, 0.01827043298969072, 0.018512907216494845, 0.01879175257731959, 0.01899381443298969, 0.019143340206185567, 0.01942622680412371, 0.01955554639175258, 0.01968890721649485, 0.019806103092783505, 0.019959670103092787]
)
X.append([0.008541473684210528, 0.008855636363636362, 0.009173701149425287, 0.009555576470588235, 0.009857258426966291, 0.010047578947368421, 0.010249493333333333, 0.010569831325301204, 0.010529417721518988, 0.010908947368421053, 0.010980839506172839, 0.011276049382716051, 0.011649317647058824, 0.011847623529411764, 0.012068988235294119, 0.012207341176470588, 0.01276369230769231, 0.012201515789473684, 0.012244948453608247, 0.013821303370786516, 0.013728082474226804, 0.014423175257731959, 0.01491216494845361, 0.015376907216494847, 0.01581336082474227, 0.01629022680412371, 0.01667818556701031, 0.01712676288659794, 0.0174419793814433, 0.017736989690721648, 0.018149195876288663, 0.018525030927835053, 0.01877558762886598, 0.0190099793814433, 0.019321154639175258, 0.01955958762886598, 0.0197939793814433, 0.02007282474226804, 0.020274886597938146, 0.02044461855670103]
)
X.append([0.008434061855670104, 0.00872516129032258, 0.009016, 0.009253023255813954, 0.009599219512195122, 0.009810594594594595, 0.010063283582089553, 0.0103733, 0.010298909090909091, 0.010782613333333333, 0.011102, 0.0109907, 0.011526666666666668, 0.01176, 0.011962758620689656, 0.012213662921348315, 0.012366967741935483, 0.012451505617977528, 0.011772123711340206, 0.014199111111111112, 0.01372, 0.014479752577319588, 0.014904082474226804, 0.015401154639175258, 0.015833567010309278, 0.0162619381443299, 0.016577154639175258, 0.016961072164948455, 0.01732074226804124, 0.01769253608247423, 0.018056247422680412, 0.01838358762886598, 0.018634144329896907, 0.018840247422680412, 0.01910071578947368, 0.019331789473684212, 0.019684301075268817, 0.019886623655913982, 0.02007282474226804, 0.02023545263157895]
)
X.append([0.00813096907216495, 0.008244123711340206, 0.008392926315789475, 0.008650133333333334, 0.008915720930232558, 0.009223529411764707, 0.009555636363636365, 0.009813213483146068, 0.010041975308641976, 0.010310072289156627, 0.01046120481927711, 0.0107506, 0.010856094117647059, 0.011263466666666668, 0.011358776470588236, 0.011632173913043478, 0.011725538461538463, 0.011996923076923079, 0.012359011235955057, 0.012106942528735632, 0.01343569230769231, 0.013752282352941177, 0.013748288659793816, 0.014107958762886598, 0.014669690721649486, 0.015146556701030926, 0.015457731958762887, 0.01581336082474227, 0.01603158762886598, 0.01630639175257732, 0.016573113402061856, 0.01687620618556701, 0.017276288659793814, 0.01748239175257732, 0.017838020618556702, 0.018056247422680412, 0.018197690721649486, 0.018448247422680412, 0.01864222680412371, 0.018884701030927837]
)
X.append([0.00813096907216495, 0.008244123711340206, 0.008392926315789475, 0.008650133333333334, 0.008915720930232558, 0.009223529411764707, 0.009555636363636365, 0.009813213483146068, 0.010041975308641976, 0.010310072289156627, 0.01046120481927711, 0.0107506, 0.010856094117647059, 0.011263466666666668, 0.011358776470588236, 0.011632173913043478, 0.011725538461538463, 0.011996923076923079, 0.012359011235955057, 0.012106942528735632, 0.01343569230769231, 0.013752282352941177, 0.013748288659793816, 0.014107958762886598, 0.014669690721649486, 0.015146556701030926, 0.015457731958762887, 0.01581336082474227, 0.01603158762886598, 0.01630639175257732, 0.016573113402061856, 0.01687620618556701, 0.017276288659793814, 0.01748239175257732, 0.017838020618556702, 0.018056247422680412, 0.018197690721649486, 0.018448247422680412, 0.01864222680412371, 0.018884701030927837]
)
X.append([0.008978064516129033, 0.009178206896551725, 0.009479272727272729, 0.009822272727272728, 0.009982933333333333, 0.010073368421052631, 0.010434421052631579, 0.010396281690140846, 0.010762632911392405, 0.011082909090909091, 0.01129590804597701, 0.011539775280898876, 0.011684272727272727, 0.011944988764044946, 0.012226044444444445, 0.012401454545454545, 0.012726636363636365, 0.012967181818181817, 0.012094231578947368, 0.014574147368421053, 0.014059463917525774, 0.014900041237113403, 0.015336494845360824, 0.015886103092783505, 0.016294268041237115, 0.016714556701030926, 0.017175257731958764, 0.017530886597938146, 0.017850442105263157, 0.018318927835051547, 0.018532425531914896, 0.018898526315789473, 0.019269894736842104, 0.01954223157894737, 0.019754297872340426, 0.020137484536082474, 0.020230608695652175, 0.020507789473684212, 0.020771873684210525, 0.02099056842105263]
)
X.append([0.00788041237113402, 0.008025896907216494, 0.008392172043010753, 0.008611876288659793, 0.008967505154639175, 0.009254432989690722, 0.009606063157894739, 0.009913154639175257, 0.01021220618556701, 0.010438515463917527, 0.010685030927835052, 0.010915381443298969, 0.010976, 0.011223130434782609, 0.011431913043478261, 0.011576782608695654, 0.01184082474226804, 0.011947478260869565, 0.01197418556701031, 0.011498666666666667, 0.013280615384615382, 0.013303752577319588, 0.01373616494845361, 0.014124123711340208, 0.014649484536082474, 0.015077855670103094, 0.015393072164948453, 0.015744659793814432, 0.016096247422680413, 0.016443793814432988, 0.016710515463917525, 0.01703381443298969, 0.017260123711340208, 0.017555134020618555, 0.017785484536082474, 0.018036041237113404, 0.018230020618556702, 0.018468453608247424, 0.018650309278350513, 0.018816]
)
X.append([0.008148595744680852, 0.008308695652173913, 0.00857861052631579, 0.008747069767441861, 0.00916352688172043, 0.009442461538461538, 0.009435034482758621, 0.009859652173913044, 0.009963692307692307, 0.010122823529411766, 0.010353411764705882, 0.010450146341463415, 0.010597835294117647, 0.010798666666666666, 0.010990341463414634, 0.011548923076923076, 0.0120246, 0.011422212765957448, 0.01103661855670103, 0.012669278350515463, 0.012484347826086957, 0.013230000000000002, 0.013798400000000002, 0.014310063157894739, 0.01477476288659794, 0.015195051546391754, 0.015619381443298969, 0.01602754639175258, 0.016419546391752575, 0.01668222680412371, 0.017037855670103096, 0.017365195876288663, 0.017664247422680412, 0.017939051546391752, 0.018197690721649486, 0.018444206185567014, 0.01867859793814433, 0.018904907216494845, 0.019179711340206185, 0.019317113402061856]
)
X.append([0.0081536, 0.008371678160919542, 0.008677234567901235, 0.00907709090909091, 0.009408, 0.009572753623188407, 0.009787147540983606, 0.009871272727272729, 0.010084516129032259, 0.010021290322580647, 0.010282461538461539, 0.010407884057971014, 0.010584000000000001, 0.010873972602739725, 0.011024328767123288, 0.011144000000000001, 0.011283243243243243, 0.011818074074074075, 0.011123526881720431, 0.012497634408602153, 0.012594580645161288, 0.013392659793814432, 0.013732123711340208, 0.014261525773195878, 0.014742432989690721, 0.01504956701030928, 0.015352659793814434, 0.015671917525773196, 0.01601542268041237, 0.016342762886597938, 0.016657979381443297, 0.016948948453608247, 0.017219711340206185, 0.017413690721649486, 0.01767637113402062, 0.017878432989690725, 0.018019876288659795, 0.01816536082474227, 0.018331051546391752, 0.018626061855670104]
)
X.append([0.007932948453608249, 0.008091705263157894, 0.0083104, 0.008606181818181817, 0.008891707317073172, 0.009227473684210527, 0.00950208, 0.009849620253164557, 0.010073368421052631, 0.010241, 0.010362210526315791, 0.01066345945945946, 0.01090043373493976, 0.01103709090909091, 0.011237333333333334, 0.011548229885057472, 0.011686211764705882, 0.011870682352941177, 0.011801023255813954, 0.01145995061728395, 0.013105513513513516, 0.013178474226804121, 0.013693573033707865, 0.014322442105263157, 0.014750515463917526, 0.01513039175257732, 0.015494103092783505, 0.015849731958762887, 0.01610432989690722, 0.016424359550561797, 0.016709, 0.01703658426966292, 0.017221272727272727, 0.017395, 0.017617727272727274, 0.017747284210526317, 0.01794122105263158, 0.018056757894736843, 0.018271326315789472, 0.018444206185567014]
)
X.append([0.00808604255319149, 0.008468923076923079, 0.008671384615384616, 0.008801333333333335, 0.009193767441860465, 0.009556088888888889, 0.00975296, 0.009882271604938273, 0.010022486486486487, 0.01039525925925926, 0.010151044776119403, 0.010439013698630137, 0.01092509090909091, 0.011091589743589744, 0.011284700000000002, 0.011548923076923076, 0.011749818181818182, 0.012231333333333334, 0.011372041237113403, 0.012940666666666668, 0.012792688172043012, 0.013538144329896907, 0.013918020618556702, 0.014491876288659795, 0.014875793814432988, 0.015138474226804125, 0.015424347826086959, 0.015700416666666668, 0.016067644444444442, 0.01645048275862069, 0.01677489655172414, 0.01703622988505747, 0.017387678160919542, 0.01762632558139535, 0.017852141176470587, 0.01807758139534884, 0.01835190804597701, 0.018311404255319148, 0.018593731958762887, 0.018723051546391752]
)
X.append([0.007952, 0.008134, 0.008338070588235295, 0.008956111111111111, 0.009080506329113924, 0.009551111111111111, 0.009552738461538462, 0.00966129230769231, 0.0099848, 0.010011076923076925, 0.010303999999999999, 0.010532421052631578, 0.0112, 0.011159901234567901, 0.011433333333333335, 0.011908689655172415, 0.012038046511627907, 0.012655999999999999, 0.01204058947368421, 0.01335883146067416, 0.013464744186046512, 0.01401501030927835, 0.014524206185567011, 0.015017237113402061, 0.015566845360824744, 0.015902268041237115, 0.016270020618556702, 0.016593319587628868, 0.016916618556701034, 0.01721162886597938, 0.017474309278350517, 0.017797608247422683, 0.018040082474226806, 0.018298721649484536, 0.01849674226804124, 0.018682639175257733, 0.01889278350515464, 0.01910696907216495, 0.019236884210526318, 0.019414315789473686]
)



#Abscisse temporelle du graphique
Z = []
for i in range(20, 60) :
    Z.append(convertion_s(i))  #fonction permettant de convertir les images en secondes


#Récupération de la valeur moyenne , la valeur maximale et la valeur minimale à chaque image
Y = []
M = []
for i in range(0, len(X[0])) :
    M.append([])

for k in range (0, len(X[0])) :
    m = 0
    s = 0
    for i in range(0, len(X)) :
        M[k].append(X[i][k])
        m+=X[i][k]
        s += 1
    Y.append(m/s)

Min = []
Max = []
for i in range(0, len(M)) :
    Min.append(min(M[i]))
    Max.append(max(M[i]))

#Tracé de la pente post-rechoc :
P1 = []
P2 = []
for i in range(21, 31) :
    P1.append(convertion_s(20+i))
    P2.append(Y[i])
print(P1, P2)

#Calcul des coefficients de régression linéaire
p1 = np.array(P1)
p2 = np.array(P2)
a, b = np.polyfit(p1, p2, 1)
print(f"Coefficients de la droite de régression : a = {a}, b = {b}")

#Création de la figure :
fig = plt.figure(figsize=(8, 6))

# Tracé de la modélisation de l'évolution de la ZMT post-rechoc
plt.plot([P1[0], P1[-1]], [a * P1[0] + b, a * P1[-1] + b], 'go-', label='Accélération post rechoc')

#Tracé des 3 nuages de points
# Tracé des deux lignes du rechoc
y_values = np.linspace(0.008, 0.020, 100)
x1_value = convertion_s(36)
x2_value = convertion_s(39)
plt.plot([x1_value, x1_value], [min(y_values), max(y_values)], color='red', linestyle='--', label='Début/Fin du rechoc')
plt.plot([x2_value, x2_value], [min(y_values), max(y_values)], color='red', linestyle='--')

# Tracé des nuages de points
plt.scatter(Z, Y, color='blue', label='LZMT en fct du t')

# Calcul de l'interpollation des courbes min et max
x_interpollation = np.linspace(min(Z), max(Z), 300)  # Points pour interpolation
spl_max = make_interp_spline(Z, Max, k=3)  # k=3 pour un spline cubique
spl_min = make_interp_spline(Z, Min, k=3)
y_max = spl_max(x_interpollation)
y_min = spl_min(x_interpollation)

# Tracer la courbe fluide
plt.plot(x_interpollation, y_max, color='black', label='Valeurs max/min')
plt.plot(x_interpollation, y_min, color='black')

#Colorer la zone "écart type"
plt.fill_between(x_interpollation, y_max, y_min, color='red', alpha=0.3)

# Titre et axes
plt.xlabel('Temps post-choc en s')
plt.ylabel('Largeur de la ZMT en m')
plt.title('Largeur de la ZMT en fonction du temps (30ms)')

# Afficher la légende
plt.legend()

plt.show()
