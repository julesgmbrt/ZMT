from Epaisseur import *
from scipy.interpolate import make_interp_spline

#Evolution de l'épaisseur de la ZMT pour chaque tir
# X est une liste de liste qui contient la valeur l'épaisseur de la ZMT pour chaque image et chaque tir
# X[0] correspond à l'évolution de l'épaisseur de la ZMT pour le tir "image_shot2"
#Ici, on exploite 90% de la largeur de la ZMT

X = [[0.008687943262411348, 0.008915914893617021, 0.009301090909090908, 0.00954709677419355, 0.009835344262295083, 0.010119872, 0.010356170940170939, 0.010553586206896552, 0.010665808695652174, 0.010965948717948718, 0.011165241379310345, 0.011495316239316239, 0.011763379310344827, 0.01201917355371901, 0.012247529411764706, 0.012682897637795275, 0.012709223140495867, 0.013407032258064515, 0.012498877697841727, 0.014323510791366909, 0.013763555555555557, 0.014896000000000001, 0.015480984615384615, 0.016120246153846156, 0.01666151937984496, 0.017076123076923078, 0.01758873846153846, 0.018059138461538463, 0.01840289230769231, 0.01875569230769231, 0.019099446153846154, 0.019434153846153848, 0.01974473846153846, 0.020078425196850394, 0.020408123076923076, 0.020712676923076923, 0.0208936, 0.02106246153846154, 0.0213731875, 0.021701723076923078]
]
X.append([0.0084028, 0.008546744525547444, 0.008799148936170212, 0.009019161290322581, 0.009302829268292682, 0.009552256, 0.009750588235294117, 0.010012610169491525, 0.01027911111111111, 0.010521411764705883, 0.010857724137931034, 0.011095593220338984, 0.011291593220338984, 0.011638117647058825, 0.011903733333333335, 0.012103404958677686, 0.01236421052631579, 0.013543599999999998, 0.01236977777777778, 0.013491590551181102, 0.014784933333333333, 0.014584624113475176, 0.015165673758865248, 0.015702241134751774, 0.016197106382978728, 0.016639148936170214, 0.01702558865248227, 0.01743694964028777, 0.017784567375886524, 0.01810150354609929, 0.01837117730496454, 0.01857968794326241, 0.018891063829787235, 0.019041191489361703, 0.01910513475177305, 0.019391489361702128, 0.01958331914893617, 0.019711205673758867, 0.019880794326241135, 0.020019801418439717]
)
X.append([0.008541473684210528, 0.008752576, 0.008980943089430895, 0.009239089430894309, 0.00946088888888889, 0.00958145132743363, 0.009782181818181818, 0.010006975999999999, 0.010084786324786325, 0.010371816513761468, 0.010637152542372881, 0.010913557522123894, 0.011270837606837607, 0.011512068376068375, 0.0117208, 0.01189835294117647, 0.012461806451612902, 0.011982791366906475, 0.012343769784172662, 0.013900444444444446, 0.013689418439716312, 0.014440056737588655, 0.01503222695035461, 0.015485390070921987, 0.015966354609929075, 0.016461219858156028, 0.016900482269503546, 0.017350865248226953, 0.01769560283687943, 0.018009758865248228, 0.0184045390070922, 0.0187770780141844, 0.019043971631205674, 0.019316425531914896, 0.019619460992907803, 0.01991971631205674, 0.02021441134751773, 0.020495205673758867, 0.020750978723404256, 0.0209622695035461]
)
X.append([0.008453565217391304, 0.00856882962962963, 0.008770625954198473, 0.0090374375, 0.009310809917355374, 0.009595900826446282, 0.009705379310344828, 0.009695241379310346, 0.00997126213592233, 0.010400141592920353, 0.0106510990990991, 0.010829, 0.011037894736842106, 0.011131387387387387, 0.011744193548387096, 0.011904256, 0.012180451612903227, 0.013263234782608697, 0.012414273381294964, 0.012921693430656933, 0.014582400000000002, 0.014299223880597015, 0.015231597122302157, 0.015746723404255317, 0.016280510638297874, 0.016761475177304967, 0.017195177304964542, 0.017545475177304967, 0.01793191489361702, 0.01829055319148936, 0.018657531914893617, 0.018993929078014185, 0.01929418439716312, 0.01960278014184397, 0.01988913475177305, 0.020183829787234046, 0.020447943262411346, 0.020750978723404256, 0.02103455319148936, 0.02122360283687943]
)
X.append([0.0085168345323741, 0.008642092307692308, 0.008786536585365854, 0.009022426229508197, 0.009249256198347109, 0.009397592920353982, 0.009561066666666666, 0.009971294117647059, 0.009842274509803921, 0.010328830188679245, 0.01069648695652174, 0.010636972972972975, 0.011172, 0.01137129411764706, 0.011680967741935484, 0.01200888888888889, 0.01219987786259542, 0.012266947368421054, 0.011777043478260871, 0.0141334375, 0.013750581560283687, 0.014559602836879433, 0.015007205673758867, 0.015521531914893617, 0.016008056737588653, 0.016438978723404257, 0.016780936170212767, 0.01714791489361702, 0.017528794326241135, 0.017892992907801417, 0.0182182695035461, 0.018549106382978724, 0.01884936170212766, 0.019071773049645392, 0.019360287769784174, 0.01964230215827338, 0.019989138686131388, 0.020232350364963504, 0.020464624113475178, 0.020699856115107915]
)
X.append([0.008204198581560285, 0.008318184397163121, 0.00848665693430657, 0.008617826771653543, 0.008776264462809918, 0.008990082644628099, 0.009248424778761062, 0.009520896000000001, 0.009647186440677967, 0.009829157024793388, 0.009959349593495936, 0.010241830508474575, 0.010466081300813009, 0.010784629921259843, 0.010914446280991736, 0.011202153846153846, 0.011299555555555556, 0.011581248, 0.01203632786885246, 0.011637696, 0.013121684210526315, 0.01323080991735537, 0.013503148936170212, 0.013870127659574467, 0.014423375886524824, 0.014937702127659575, 0.015282439716312058, 0.015651798561151082, 0.01596201438848921, 0.01622992805755396, 0.01652886330935252, 0.0168365390070922, 0.017234099290780142, 0.01743704964539007, 0.017801248226950356, 0.01803478014184397, 0.018176567375886528, 0.01843790070921986, 0.018654751773049646, 0.018877163120567374]
)
X.append([0.008204198581560285, 0.008369343065693431, 0.008458043795620438, 0.00875147967479675, 0.00894306976744186, 0.009163803278688525, 0.00942651968503937, 0.00971288888888889, 0.00984237837837838, 0.010094837606837607, 0.0102725, 0.010218384615384617, 0.010576672897196262, 0.010781831775700934, 0.011151466666666667, 0.01128740186915888, 0.011616146788990827, 0.012201441441441443, 0.011494646153846154, 0.013405823529411763, 0.013328000000000001, 0.013864567375886526, 0.014433496402877697, 0.014940482269503546, 0.015440907801418439, 0.015888690647482013, 0.016308892086330934, 0.0166416690647482, 0.017040470588235296, 0.017309163120567374, 0.017626099290780142, 0.01790967375886525, 0.018262751773049646, 0.018485163120567378, 0.01871313475177305, 0.01892998581560284, 0.019130156028368796, 0.019299744680851064, 0.019474893617021274, 0.019644482269503546]
)
X.append([0.00819863829787234, 0.008379710144927536, 0.008559157894736841, 0.008742222222222222, 0.009070178861788618, 0.009280520325203254, 0.009481709401709401, 0.009677084745762711, 0.00997880701754386, 0.010035200000000001, 0.010350827586206895, 0.010539298245614035, 0.01078, 0.011022666666666668, 0.011358439024390245, 0.011540097560975609, 0.011789898305084747, 0.012591419354838708, 0.011818187499999999, 0.012454229007633587, 0.013959186440677968, 0.013944823529411765, 0.014509681159420291, 0.015023886524822696, 0.01551041134751773, 0.016008056737588653, 0.01639449645390071, 0.016775375886524824, 0.017136794326241135, 0.017473191489361703, 0.0177873475177305, 0.01806258156028369, 0.018298893617021274, 0.018502964028776978, 0.01866935251798561, 0.018906244604316547, 0.01912621582733813, 0.01934336690647482, 0.019537956834532376, 0.019808510638297874]
)
X.append([0.008910131386861314, 0.00908893023255814, 0.009278387096774194, 0.009498944, 0.009661018181818182, 0.009746545454545456, 0.010120727272727273, 0.010073660377358492, 0.010480842105263158, 0.010682, 0.011015529411764707, 0.01128235294117647, 0.011509647058823529, 0.011766272, 0.012042240000000001, 0.012236231404958678, 0.012478117647058824, 0.012800188976377953, 0.012052537313432836, 0.014766273381294963, 0.014103659574468085, 0.014993304964539005, 0.015435347517730498, 0.016027517730496453, 0.01650014184397163, 0.016950524822695035, 0.017406468085106385, 0.017798468085106385, 0.018133525179856117, 0.01856022695035461, 0.018816, 0.019157237410071942, 0.01948719424460432, 0.019772028776978416, 0.020028927536231887, 0.02034785815602837, 0.02047335294117647, 0.02074779856115108, 0.020987510791366907, 0.0212046618705036]
)
X.append([0.008029049645390071, 0.008184737588652484, 0.008549605839416058, 0.008685163120567376, 0.00893642105263158, 0.009232176470588235, 0.009529757575757577, 0.009797052631578948, 0.010088060606060606, 0.010317679389312977, 0.010453333333333334, 0.010687007299270074, 0.010769364341085271, 0.0110005, 0.01120042748091603, 0.011388946564885497, 0.01164965925925926, 0.01180862015503876, 0.011873244444444445, 0.011604396946564887, 0.013232314960629921, 0.013325179856115109, 0.013793323741007195, 0.014174043165467626, 0.014715290780141842, 0.015146212765957448, 0.01547148936170213, 0.015805106382978724, 0.016155404255319146, 0.016486241134751774, 0.016726273381294964, 0.016915223021582732, 0.01704504964539007, 0.017348085106382978, 0.017562156028368796, 0.017801248226950356, 0.0179930780141844, 0.018229390070921985, 0.018415659574468085, 0.018596368794326242]
)
X.append([0.008229159420289855, 0.008404941176470589, 0.008590158273381296, 0.008668983606557377, 0.008947175572519084, 0.009149705426356588, 0.009157647058823529, 0.00958472131147541, 0.0097216, 0.009895529411764706, 0.010155457627118643, 0.010263582608695653, 0.010487661016949153, 0.01069551724137931, 0.010955547826086957, 0.011439272727272728, 0.011910500000000001, 0.011349767441860465, 0.011221, 0.01284157664233577, 0.01265223880597015, 0.01342106474820144, 0.01396253237410072, 0.014427856115107916, 0.014904340425531914, 0.015310241134751773, 0.015741163120567378, 0.016127602836879435, 0.01651682269503546, 0.016780936170212767, 0.01709231205673759, 0.01741758865248227, 0.017687262411347517, 0.017979177304964542, 0.018237730496453903, 0.018471262411347517, 0.018707574468085107, 0.01893554609929078, 0.0191690780141844, 0.019302524822695035]
)
X.append([0.008123761194029851, 0.008327755725190839, 0.00860169105691057, 0.008834, 0.009139603603603604, 0.009147923076923078, 0.009350833333333334, 0.009522828282828284, 0.009613898989898992, 0.009622568421052632, 0.009864659793814432, 0.010001821782178217, 0.010187916666666666, 0.010633960784313726, 0.01078, 0.010862845360824743, 0.011080533333333333, 0.011589128205128207, 0.010981939393939395, 0.012636060606060607, 0.012629839416058395, 0.013457726618705038, 0.013778382978723403, 0.01426212765957447, 0.014776453900709221, 0.015065588652482271, 0.01540476595744681, 0.015705021276595746, 0.016021957446808514, 0.01633333333333333, 0.016641929078014185, 0.016919943262411346, 0.017214638297872342, 0.017423148936170214, 0.01767058156028369, 0.017870751773049646, 0.018037560283687946, 0.01822104964539007, 0.01843790070921986, 0.018752056737588656]
)
X.append([0.007908303030303031, 0.008003590551181102, 0.008200130081300813, 0.008660296296296296, 0.008759172413793105, 0.009088742268041237, 0.00915712, 0.009225320388349514, 0.009587514018691588, 0.009595659574468085, 0.00988624, 0.010297, 0.010837836065573772, 0.010923294117647059, 0.011181639344262296, 0.011640832, 0.011785290322580647, 0.012451577235772358, 0.01184178417266187, 0.013560842105263158, 0.013466707692307693, 0.014056397163120567, 0.014601304964539007, 0.015093390070921985, 0.015646638297872342, 0.016030297872340428, 0.016355574468085103, 0.016694751773049646, 0.017031148936170214, 0.017345304964539007, 0.017594877697841727, 0.01793611510791367, 0.018232230215827337, 0.018497323741007193, 0.018763177304964542, 0.018999489361702128, 0.0192274609929078, 0.019472113475177303, 0.01963384172661871, 0.019862273381294964]
)
X.append([0.008101333333333334, 0.00831976119402985, 0.008496237037037037, 0.008664444444444445, 0.0089915, 0.009225889763779528, 0.009328846153846155, 0.00952100900900901, 0.009635140186915888, 0.009951298245614035, 0.009807762376237624, 0.010093084112149533, 0.010549, 0.010788672566371681, 0.010979438596491229, 0.011335927272727272, 0.011413909909909911, 0.011872896, 0.011044671532846715, 0.012911111111111113, 0.012675664122137408, 0.013504115942028987, 0.013900489208633094, 0.01449263768115942, 0.01493548201438849, 0.015246297872340426, 0.01559516417910448, 0.015899971223021583, 0.016293052631578948, 0.016675076923076924, 0.016993648854961834, 0.017248, 0.017610076335877863, 0.01787094573643411, 0.01817786046511628, 0.01839083076923077, 0.01866638167938931, 0.01874214492753623, 0.018991148936170214, 0.01915239716312057]
)
X.append([0.007784397163120567, 0.008014892307692307, 0.008444896551724137, 0.008456973913043479, 0.008944384615384616, 0.009123245283018867, 0.009328880733944955, 0.00946858181818182, 0.009588108108108109, 0.009594666666666666, 0.009849, 0.00994748514851485, 0.010291849056603776, 0.010640504504504504, 0.010728621359223301, 0.010987094339622642, 0.011110400000000001, 0.011633878260869566, 0.01097908661417323, 0.012701470085470084, 0.012631424460431657, 0.013429525179856117, 0.013825645390070924, 0.014346071942446045, 0.014833507246376812, 0.015190695035460994, 0.015538212765957446, 0.01600527659574468, 0.016380595744680853, 0.016716992907801417, 0.017128453900709217, 0.017478751773049642, 0.01784017021276596, 0.018032, 0.018259971631205674, 0.01847682269503546, 0.018721475177304964, 0.018910524822695035, 0.019182978723404256, 0.019433191489361703]
)
X.append([0.007981787234042553, 0.008132579710144926, 0.008325611940298508, 0.008526, 0.008717811965811966, 0.008949499999999999, 0.009185513513513514, 0.009428452173913044, 0.009579500000000001, 0.009704854368932038, 0.009884756756756758, 0.01009776923076923, 0.010395000000000001, 0.010605981308411215, 0.010831207207207207, 0.011113367521367521, 0.011270837606837607, 0.011442991304347826, 0.011527457627118643, 0.011615744, 0.012971636363636364, 0.01305276595744681, 0.01357263157894737, 0.014223591240875914, 0.014608345323741006, 0.01503136690647482, 0.015399205673758866, 0.015782865248226953, 0.016080340425531917, 0.01637557894736842, 0.01664812121212121, 0.016941473684210527, 0.017155939393939394, 0.017346, 0.017544969696969698, 0.017676661870503596, 0.01780074820143885, 0.017876892086330934, 0.018077122302158275, 0.018187687943262414]
)

Z = []
for i in range(20, 60) :
    Z.append(convertion_s(i))


#Récupération de la valeur moyenne , la valeur maximale et la valeur minimale à chaque image
Y = []
M = []
for i in range(0, len(X[0])) :
    M.append([])

for k in range (0, len(X[0])) :
    m = 0
    s = 0
    for i in range(0, len(X)) :
        M[k].append(X[i][k])
        m+=X[i][k]
        s += 1
    Y.append(m/s)

Min = []
Max = []
for i in range(0, len(M)) :
    Min.append(min(M[i]))
    Max.append(max(M[i]))

#Tracé de la pente post-rechoc :
P1 = []
P2 = []
for i in range(21, 31) :
    P1.append(convertion_s(20+i))
    P2.append(Y[i])
print(P1, P2)
p1 = np.array(P1)
p2 = np.array(P2)
a, b = np.polyfit(p1, p2, 1)
print(f"Coefficients de la droite de régression : a = {a}, b = {b}")

#Création de la figure :
fig = plt.figure(figsize=(8, 6))

# Tracé de la modélisation de l'évolution de la ZMT post-rechoc
plt.plot([P1[0], P1[-1]], [a * P1[0] + b, a * P1[-1] + b], 'go-', label='Accélération post rechoc')

#Tracé des 3 nuages de points
# Tracé des deux lignes du rechoc
y_values = np.linspace(0.008, 0.02, 100)
x1_value = convertion_s(36)
x2_value = convertion_s(39)
plt.plot([x1_value, x1_value], [min(y_values), max(y_values)], color='red', linestyle='--', label='Début/Fin du rechoc')
plt.plot([x2_value, x2_value], [min(y_values), max(y_values)], color='red', linestyle='--')

# Tracé des nuages de points
plt.scatter(Z, Y, color='blue', label='LZMT en fct du t')

# Créer une courbe fluide par interpolation spline
x_interpollation = np.linspace(min(Z), max(Z), 300)  # Points pour interpolation
spl_max = make_interp_spline(Z, Max, k=3)  # k=3 pour un spline cubique
spl_min = make_interp_spline(Z, Min, k=3)
y_max = spl_max(x_interpollation)
y_min = spl_min(x_interpollation)

# Tracer la courbe fluide
plt.plot(x_interpollation, y_max, color='black', label='Valeurs max/min')
plt.plot(x_interpollation, y_min, color='black')

#Colorer la zone "écart type"
plt.fill_between(x_interpollation, y_max, y_min, color='red', alpha=0.2)

# Titre et axes
plt.xlabel('Temps post-choc en s')
plt.ylabel('Largeur de la ZMT en m')
plt.title('Largeur de la ZMT en fonction du temps (30ms)')

# Afficher la légende
plt.legend()

plt.show()
